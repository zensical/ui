function z(e,n,t={}){return{name:e,from:n,meta:t}}function Q(e,n){let t=[{value:e,depth:0}];for(let o=0,r=-1,i=0;o>=0;){let{value:p,depth:s}=t[o];if(r<=s&&p.type==="operator"&&p.data.operands.length>0)for(let m=p.data.operands.length;m>0;)t[++o]={value:p.data.operands[--m],depth:s+1};else{let m=n(p,i++,s);if(typeof m<"u")return m;--o}r=s}}var b=class extends Error{constructor(t,o){super(o);this.code=t}};function K(e,n){let t=it(e);for(let o=0;o<t.length;o++){let r=n(t[o]);if(typeof r<"u")return r}}function it(e){return e.items}function q(e,n){return K(e,t=>{let{matches:o}=t;for(let r=0;r<o.length;r++){let i=n(o[r],t);if(typeof i<"u")return i}})}function W(e,n=new Map){return(t,...o)=>{let r=n.get(t);return typeof r>"u"&&n.set(t,r=e(t,...o)),r}}function R(e,n){return Object.defineProperty(n,"name",{value:e}),n}async function k(e){let n=[];if(typeof e.plugins<"u")for(let t=0;t<e.plugins.length;t++){let o=e.plugins[t];n.push(typeof o=="function"?await o(e):o)}return n}async function G(e,n){for(let t=0;t<e.length;t++){let o=n(e[t]);o instanceof Promise&&await o}}function P(e,n,t){for(let o=0;o<e.length;o++){let r=n(t,e[o]);typeof r<"u"&&(t=r)}return t}async function J(e,n,t){for(let o=0;o<e.length;o++){let r=n(t,e[o]);typeof r<"u"&&(t=r instanceof Promise?await r??t:r)}return t}function ce(e){return typeof e!="object"?{node:e,children:[]}:e}function le(e){return typeof e=="object"&&e!==null&&"select"in e&&"values"in e}function Z(e){return Math.max(1,Math.ceil(Math.log2(e)))}function ae(e){if(e.d+e.f+e.x>32)throw new RangeError("Bit format exceeds 32 bits");return e}function Y(e,n,t){let o=Z(e),r=Z(n),i=typeof t<"u"?Z(t):32-o-r;return ae({d:o,f:r,x:i})}var h=[0];for(let e=0;e<32;e++)h.push(h[e]|1<<e);function xe(e){return new Uint8Array(e)}function ne(e){return new Uint32Array(e)}function I(){return[0].slice(0,0)}var L=class{constructor(n=[]){this.data=n}magnitude=0;add(n,t,o){this.data.push({start:n,end:t,value:o}),this.magnitude=0}get(n){for(let t=0;t<this.data.length;t++){let{start:o,end:r,value:i}=this.data[t];if(n>=o&&n<r)return i}return 0}forEach(n){for(let t=0;t<this.data.length;t++){let{start:o,end:r,value:i}=this.data[t];for(let p=o;p<r;p++)n(p,i)}}get length(){return this.magnitude||=j(this)}};var A=class{constructor(n,t=I()){this.data=n;this.cols=t}magnitude=0;add(n,t){this.cols.push(n),this.data.push(t),this.magnitude=0}get(n){for(let t=0;t<this.cols.length;t++)if(this.cols[t]===n)return this.data[t];return 0}forEach(n){for(let t=0;t<this.cols.length;t++)n(this.cols[t],this.data[t])}get length(){return this.magnitude||=j(this)}};function j(e){let n=0;return e.forEach((t,o)=>{n+=o*o}),Math.sqrt(n)}function de(e,n){e instanceof L?e.data.forEach((t,o)=>{n(t,o)}):e.forEach((t,o)=>{n({start:t,end:t+1,value:1},o)})}var S=class{constructor(n,t=ne(Math.ceil(n/32))){this.size=n;this.data=t}get(n){return this.data[n>>>5]>>>n&1}set(n){this.data[n>>>5]|=1<<(n&31)}forEach(n){let t=this.size&31;for(let o=0;o<this.data.length;o++){if(this.data[o]===0)continue;let r=this.data[o];t&&o===this.data.length-1&&(r=r&h[t]);for(let i=0,p=32-Math.clz32(r);i<p;i++)r&1<<i&&n((o<<5)+i)}}};function $(e,n){for(let t=0;t<e.data.length;t++)e.data[t]&=~n.data[t]}function v(e,n){n*=h[32]>>>0;for(let t=0;t<e.data.length;t++)e.data.fill(n)}function N(e,n){for(let t=0;t<e.data.length;t++)e.data[t]&=n.data[t]}function C(e){for(let n=0;n<e.data.length;n++)e.data[n]^=h[31]}function H(e,n){for(let t=0;t<e.data.length;t++)e.data[t]|=n.data[t]}function ge(e,n){let t=[{value:e,depth:0}];for(let o=1,r=0;o>0;r++){let{value:i,depth:p}=t[--o],s=n(i,r,p);if(typeof s<"u")return s;for(let m=i.children.length;m>0;)t[o++]={value:i.children[--m],depth:p+1}}}async function ie(e,n){let{fields:t,plugins:o=[]}=n,r=Y(e.length,t.length),i=[];for(let m=0;m<t.length;m++)i.push({terms:[],index:new Map});for(let m=0;m<e.length;m++)for(let f=0;f<t.length;f++){let l=t[f].from(e[m]);if(typeof l>"u")continue;let u=m<<r.f|f;l=P(o,(x,d)=>d.onFilterInput?.(x,u,r),l);let c=i[f],a=I();l=Array.isArray(l)?l:[l];for(let x=0;x<l.length;x++){let d=ce(l[x]);ge(d,(g,y,T)=>{let E=c.index.get(g.node);typeof E>"u"&&c.index.set(g.node,E=I());let V=c.terms.length;for(let O=0;O<E.length;O++){let _=c.terms[E[O]];if(_.position.depth===T){if(T&&a[T-1]!==_.position.prior)continue;V=E[O];break}}V===c.terms.length&&c.terms.push({value:g.node,occurrences:I(),position:{prior:T?a[T-1]:V,depth:T}});let{occurrences:w}=c.terms[V];w.push(u<<r.x|y),a[T]=V;for(let O=0;O<E.length;O++)if(E[O]===V)return;E.push(V)})}}let p={documents:e.length,fields:t.length},s={shards:i,space:r,count:p};return await G(o,m=>m.onFilterStore?.(s,n,e)),s}function Te(e,n,t,o={}){let r=[];if(n<0||n>=e.count.fields)return r;let i=e.shards[n],p=new Map,{count:s=1/0,depth:m=1/0}=o;for(let f=0;f<i.terms.length;f++){let l=i.terms[f],u=t(l,f);if(typeof u<"u"){let{prior:c,depth:a}=l.position;if(a>m)continue;let x=p.get(l);typeof x>"u"&&p.set(l,x={node:u,children:[]});let d=r;a>0&&(d=p.get(i.terms[c]).children),d.length<s&&d.push(x)}}return r}function ye(e,n,t){let{documents:o,terms:r}=M(e);if(t<0||t>=e.count.fields)return{documents:o,terms:r};let i=e.shards[t];return n.forEach(p=>{let{occurrences:s}=i.terms[p];for(let m=0;m<s.length;m++){let u=s[m]>>>e.space.x>>>e.space.f;o.set(u)}r[t].set(p)}),{documents:o,terms:r}}function Ee(e){let{documents:n,terms:t}=M(e);v(n,1);for(let o=0;o<t.length;o++)v(t[o],1);return{documents:n,terms:t}}function M(e){return{documents:new S(e.count.documents),terms:e.shards.map(({terms:n})=>new S(n.length))}}function se(e,n,t){let{compiler:o,fields:r,plugins:i=[]}=t,{input:p,scope:s,abort:m=!1}=P(i,(u,c)=>c.onFilterQuery?.(u,e,t),n),f={items:[],query:{select:M(e),values:[]}},l=new Map;if(m===!1){let u=o(t),{select:c,values:a}=u(p,e);typeof s<"u"&&N(c.documents,s);let x=new Map;f.query={select:c,values:a},c.terms.forEach((d,g)=>{d.forEach(y=>{let T=e.shards[g],{occurrences:E}=T.terms[y];for(let V=0;V<E.length;V++){let w=E[V],O=w>>>e.space.x,_=O>>>e.space.f;if(!c.documents.get(_))continue;let D=x.get(O);typeof D>"u"&&x.set(O,D=new A(I()));let nt=w&h[e.space.x];D.add(nt,y)}})}),c.documents.forEach(d=>{let g={id:d,matches:[]};f.items.push(g),l.set(d,g)}),x.forEach((d,g)=>{let y=g>>>e.space.f,T=g&h[e.space.f];l.get(y).matches.push({id:g,field:r[T].name,value:{filter:d},score:0})})}return P(i,(u,c)=>c.onFilterResult?.(u,e,t),f)}function ee(e){let{fields:n}=e;return(t,o)=>{if(le(t))return t;let r=[Ee(o)],i=[],p=0;return Q(t,({type:s,data:m})=>{switch(s){case"value":let f=n.findIndex(({name:c})=>c===m.field);if(f===-1){r[p++]=M(o);break}let l=m.value;if(typeof l!="object"){let c=new A(I()),a=o.shards[f],x=a.index.get(l);if(typeof x<"u")for(let d=0;d<x.length;d++){let g=x[d];if(typeof m.depth<"u"){let{position:y}=a.terms[g];if(y.depth!==m.depth)continue}c.add(g,1)}l=c}r[p++]=ye(o,l,f),i.push({...m,value:l});break;case"operator":let u=p-m.operands.length;switch(m.operator){case"or":for(;p>u+1&&p--;){H(r[u].documents,r[p].documents);for(let c=0;c<n.length;c++)H(r[u].terms[c],r[p].terms[c])}break;case"and":for(;p>u+1&&p--;){N(r[u].documents,r[p].documents);for(let c=0;c<n.length;c++)H(r[u].terms[c],r[p].terms[c])}break;case"not":C(r[u].documents);for(let c=0;c<n.length;c++)v(r[u].terms[c],0);for(;p>u+1&&p--;)$(r[u].documents,r[p].documents)}}}),{select:r[0],values:i}}}function pe(e){return{name:e.name,data:e.data,onFilterOptions:e.onFilterOptions,onFilterInput:e.onFilterInput,onFilterStore:e.onFilterStore,onFilterQuery:e.onFilterQuery,onFilterResult:e.onFilterResult}}function Ie(e){return typeof e=="object"&&e!==null&&"type"in e&&"data"in e}function he(e){return typeof e=="object"&&e!==null&&"select"in e&&"values"in e}function Ve(e){return e.normalize("NFKD").toLowerCase()}function be(e,n){let t=Math.min(e.length,n.length);for(let o=0;o<t;o++)if(e.charCodeAt(o)!==n.charCodeAt(o))return o;return t}function me(e,n,t=0,o=e.length){for(let r=0;t<o;t+=1+ +(r>65535)){let i=n(r=e.codePointAt(t),t);if(typeof i<"u")return i}}function te(e,n,t=0,o=e.length){let r=I();return me(e,i=>{r.push(i);let p=n(String.fromCodePoint(...r),r.length);if(typeof p<"u")return p},t,o)}function Re(e,n,t=0,o=e.length){let r=t;for(let i=0;r<o;r++)switch(i=e.charCodeAt(r),i){case 60:r>t&&n(t,t=r);continue;case 62:t=r+1}r>t&&n(t,r)}function ue(e,n,t,o=0){return Re(e,(r,i)=>n(e,(p,s)=>{o=t({value:e.slice(p,s),index:o,start:p,end:s})},r,i)),o}function Oe(e,n,t,o=0){for(let r=0,i=0;r<e.length;i+=e[r++].length)o=ue(e[r],n,p=>(p.start+=i,p.end+=i,t(p)),o);return o}function Pe(e){let n=new RegExp(e,"gu");return(t,o,r=0,i=t.length)=>{n.lastIndex=r;let p,s=0;do{p=n.exec(t);let m=p?.index??i;r<m&&o(r,Math.min(m,i)),p&&(s=p[0].length,r=p.index+s,s===0&&(n.lastIndex=p.index+1))}while(p&&r<i)}}async function Ae(e,n){let{separator:t,transform:o,fields:r,plugins:i=[]}=n,p=Y(e.length,r.length),s=new Map;for(let u=0;u<e.length;u++)for(let c=0;c<r.length;c++){let a=r[c].from(e[u]);if(typeof a>"u")continue;let x=u<<p.f|c;a=P(i,(d,g)=>g.onTextInput?.(d,x,p),a),a=Array.isArray(a)?a:[a],Oe(a,t,d=>{let g=P(i,(y,T)=>T.onTextTokens?.(y),[d]);for(let y=0;y<g.length;y++){d=g[y];let T=o(d.value),E=s.get(T);typeof E>"u"?s.set(T,[x<<p.x|d.index]):E.push(x<<p.x|d.index)}return g.length?d.index+1:d.index})}let m={documents:e.length,fields:r.length},f={terms:[],index:new Map,space:p,count:m},l=[...s.keys()].sort();for(let u=0;u<l.length;u++)f.index.set(l[u],u),f.terms.push({value:l[u],occurrences:s.get(l[u])});return await G(i,u=>u.onTextStore?.(f,n,e)),f}function ve(e,n,t){let{documents:o,terms:r}=B(e);return t<0||t>=e.count.fields?{documents:o,terms:r}:(n.forEach(i=>{let{occurrences:p}=e.terms[i];for(let s=0;s<p.length;s++){let f=p[s]>>>e.space.x;if((f&h[e.space.f])!==t)continue;let u=f>>>e.space.f;o.set(u)}r.set(i)}),{documents:o,terms:r})}function Fe(e,n){let{documents:t,terms:o}=B(e),r=e.space.f+e.space.x;return n.forEach(i=>{let{occurrences:p}=e.terms[i];for(let s=0;s<p.length;s++)t.set(p[s]>>>r);o.set(i)}),{documents:t,terms:o}}function B(e){return{documents:new S(e.count.documents),terms:new S(e.terms.length)}}function we(e,n,t){let{compiler:o,fields:r,plugins:i=[]}=t,{input:p,scope:s,abort:m=!1}=P(i,(u,c)=>c.onTextQuery?.(u,e,t),n),f={items:[],query:{select:B(e),values:[]}},l=new Map;if(m===!1){let u=o(t),{select:c,values:a}=u(p,e);typeof s<"u"&&N(c.documents,s);let x=new S(r.length),d=new Map;f.query={select:c,values:a},c.terms.forEach(g=>{v(x,0);for(let T=0;T<a.length;T++){let{field:E,value:V}=a[T];if(E==="*"){v(x,1);break}else if(V.get(g)){for(let w=0;w<r.length;w++)if(r[w].name===E){x.set(w);break}}}let{occurrences:y}=e.terms[g];for(let T=0;T<y.length;T++){let E=y[T],V=E>>>e.space.x,w=V>>>e.space.f;if(!c.documents.get(w))continue;let O=V&h[e.space.f];if(!x.get(O))continue;let _=d.get(V);typeof _>"u"&&d.set(V,_=new A(I()));let D=E&h[e.space.x];_.add(D,g)}}),c.documents.forEach(g=>{let y={id:g,matches:[]};f.items.push(y),l.set(g,y)}),d.forEach((g,y)=>{let T=y>>>e.space.f,E=y&h[e.space.f];l.get(T).matches.push({id:y,field:r[E].name,value:{text:g},score:0})})}return P(i,(u,c)=>c.onTextResult?.(u,e,t),f)}function Le(e,n=10){return e.length>1?1+e[e.length-1]-e[0]:n}function fe(e,n,t,o=10){let r=[];e.value.text.forEach((s,m)=>{for(let f=0;f<n.data.length;f++){let{start:l,end:u}=n.data[f];l<=m&&m<u&&r.push({index:s,value:f})}}),r.sort((s,m)=>s.index-m.index);let i=r.slice(0,1),p=0;for(let s=0;s<r.length-1;s++){let m=r[s],f=r[s+1],l;if(f.index-m.index>o||f.value===m.value)l=i.map(({index:u})=>u),i=[r[s+1]];else{for(let u=0;u<i.length;u++){let c=i[u];if(c.value===f.value){if(m.index-c.index>f.index-m.index){let a=i.splice(u+1);l=i.map(({index:x})=>x),i=[...a,r[s+1]]}else l=i.map(({index:a})=>a),i=[r[s+1]];break}}typeof l>"u"&&i.push(r[s+1])}if(typeof l<"u"){let u=t(l,p++);if(typeof u<"u")return u}}if(i.length)return t(i.map(({index:s})=>s),p)}function _e(e){let{transform:n,parser:t,fields:o}=e,r=t(e);return(i,p)=>{if(he(i))return i;typeof i=="string"&&(i=r(i));let s=[B(p)],m=[],f=0;return Q(i,({type:l,data:u})=>{switch(l){case"value":let c=u.value;if(typeof c=="string"){let x=new A(I()),d=p.index.get(n(c));typeof d<"u"&&x.add(d,1),c=x}if(u.field==="*")s[f++]=Fe(p,c);else{let x=o.findIndex(({name:d})=>d===u.field);s[f++]=ve(p,c,x)}m.push({...u,value:c});break;case"operator":let a=f-u.operands.length;switch(u.operator){case"or":for(;f>a+1&&f--;)H(s[a].documents,s[f].documents),H(s[a].terms,s[f].terms);break;case"and":for(;f>a+1&&f--;)N(s[a].documents,s[f].documents),H(s[a].terms,s[f].terms);break;case"not":for(C(s[a].documents),v(s[a].terms,0);f>a+1&&f--;)$(s[a].documents,s[f].documents)}}}),{select:s[0],values:m}}}function Ne(e,n){return Q(e,(t,o,r)=>{if(t.type!=="value")return;let i=n(t.data,o,r);if(typeof i<"u")return i})}function oe(e){if(e.length===0)return[];let n=[],t=[];for(let i=0;i<e.length;i++){let{start:p,end:s}=e[i];t.push({index:p,value:i}),t.push({index:s,value:i})}t.sort((i,p)=>i.index-p.index);let o=new Set([t[0].value]),r=t[0].index;for(let i=1;i<t.length;i++){let{index:p,value:s}=t[i];if(o.size&&r<p){let m=s;o.forEach(f=>{e[f].start>r||e[f].end<p||e[m].start!==e[f].start&&e[m].end!==e[f].end&&(m=f)}),n.push({start:r,end:p,value:e[m].value})}r=p,o.has(s)?o.delete(s):o.add(s)}return n}function U(e){let n=[];for(let t=0;t<e.values.length;t++){let{value:o}=e.values[t];de(o,({start:r,end:i})=>{n.push({start:r,end:i,value:t})})}return new L(oe(n))}function He(e,n="or",t){let{separator:o}=e;return t??=r=>({field:"*",value:r.value}),r=>{let i=[];return ue(r,o,p=>{let s=t(p);typeof s<"u"&&i.push({type:"value",data:s})}),{type:"operator",data:{operator:n,operands:i}}}}async function Qe(e,n){let t=await k(n),o=await J(t,(i,p)=>p.onTextOptions?.(i,e),{...n,plugins:t}),r=await Ae(e,o);return R("text",i=>{if(i.type!=="text")throw new b("unsupported");return{type:i.type,data:we(r,i.data,o)}})}function F(e){return{name:e.name,data:e.data,onTextOptions:e.onTextOptions,onTextInput:e.onTextInput,onTextTokens:e.onTextTokens,onTextStore:e.onTextStore,onTextQuery:e.onTextQuery,onTextResult:e.onTextResult}}function ke(e){let{handlers:n}=e,t,o=new Map;return pe({name:"aggregation",onFilterStore(r,i){for(let p=0;p<n.length;p++){let s=n[p](r,i);o.set(s.name,s)}},onFilterQuery(r){t=r.aggregation?.input??[]},onFilterResult(r){let{select:i}=r.query;r.aggregations=[];for(let p of t){let s=o.get(p.type);if(typeof s>"u")continue;let m=!0;i.documents.forEach(f=>{m=!1}),m&&v(i.documents,1),r.aggregations.push(s(p,i))}}})}function Me(e={}){let{empty:n=!1,limit:t}=e;return(o,{fields:r})=>{let i=o.space.f+o.space.x;return R("term",({type:p,data:s},{documents:m})=>{if(p!=="term")throw new b("unsupported");let f=r.findIndex(({name:u})=>u===s.field),l=Te(o,f,u=>{let c=0,{occurrences:a}=u;for(let x=0;x<a.length;x++)m.get(a[x]>>>i)&&c++;if(!(n===!1&&c===0))return{value:u.value,count:c}},{...t,...s.limit});return{type:p,data:{field:s.field,value:l}}})}}function Be(e,n="prefix"){return{type:n,data:e}}function Ue(e){return typeof e=="object"&&"type"in e&&typeof e.type=="string"&&"data"in e&&typeof e.data=="string"}function De(e,n={}){let{prefix:t=2,filter:o=[]}=n,r=e.terms,i=new Map,p=xe(r.length),s=I();for(let m=0;m<r.length;m++){let f=r[m];te(f,(u,c)=>(i.set(u,i.get(u)??m),c===t||void 0));let l=m?r[m-1]:"";p[m]=be(l,f)}for(let m=0;m<o.length;m++){let f=o[m],l=e.index?.get(f);typeof l<"u"&&s.push(l)}return s.sort((m,f)=>m-f),{terms:r,index:i,cover:p,exact:s}}function ze(e,n){let t="",o=-1,r=-1;if(te(n,s=>{let m=e.index.get(s);if(typeof m>"u")return!0;t=s,o=m}),o!==-1)for(let s=t.length;s<n.length;){let m=e.terms[o];if(m.length===s)if(++o===e.terms.length){o=-1;break}else continue;if(m.charCodeAt(s)===n.charCodeAt(s))s++;else if(e.terms.length===++o||e.cover[o]<s){o=-1;break}}if(o===-1)return;for(r=o+1;r<e.terms.length&&!(e.cover[r]<n.length);r++);let i=[],p=e.exact.filter(s=>s>o&&s<r);for(let s=0;s<p.length;s++)o<p[s]&&i.push({start:o,end:p[s]-1,value:1}),o=p[s]+1;return o<=r&&i.push({start:o,end:r,value:1}),new L(i)}function Ke(e={}){return F({name:"expansion",onTextStore(n,t){let{transform:o}=t;this.data??=De({terms:n.terms.map(({value:r})=>r),index:n.index},{prefix:e.prefix,filter:e.filter?.map(o)})},onTextQuery(n,t,o){let{transform:r,parser:i}=o;if(typeof n.input=="string")n.input=i(o)(n.input);else if(!Ie(n.input))return;Ne(n.input,p=>{let s=p.value;if(Ue(s))s=r(s.data);else return;p.value=ze(this.data,s)??s})}})}function We(e){let n={...e,plugins:[]},t,o,r;return F({name:"filter",async onTextOptions(i,p){n.plugins=await k(e),r=await ie(p,n)},onTextQuery(i){typeof i.filter<"u"&&(t=i.filter,o??=ee(n),t.input=o(t.input,r),i.scope=t.input.select.documents)},onTextResult(i){if(typeof t<"u"){let p=!0;i.query.select.documents.forEach(m=>{p=!1}),p||(t.scope=i.query.select.documents);let s=se(r,t,n);i.aggregations=s.aggregations,t=void 0}}})}function Ge(){return{tables:new Map}}function Ye(e,n={}){let{count:t}=n;return R("term",o=>{let r=U(o);return(i,p)=>{let s=[];return i.value.text.forEach((m,f)=>{let l=p[m]>>>10,u=p[m]&h[10];for(let x=0;x<r.data.length;x++){let{start:d,end:g}=r.data[x];if(d<=f&&f<g){f=r.data[x].value;break}}let c=l,a=l+u;s.push({start:c,end:a,value:f})}),s.sort((m,f)=>m.start-f.start),{ranges:oe(s).slice(0,t)}}})}function je(e){let n,t;return F({name:"highlight",data:Ge(),onTextInput(o,r){let{tables:i}=this.data;i.set(r,t=I())},onTextTokens(o){for(let r=0;r<o.length;r++){let{index:i,start:p,end:s}=o[r];t[i]=p<<10|s-p}},onTextStore(o){n=e.handler(o)},onTextResult(o){let{tables:r}=this.data,i=n(o.query);q(o,p=>{let s=r.get(p.id);if(p.value.highlight)return;let m=i(p,s);p.value={...p.value,highlight:m}})}})}function Xe(){return{directives:[]}}function re(...e){return(n,t)=>{for(let o=0;o<e.length;o++){let r=e[o](n,t);if(r!==0)return r}return 0}}function qe(e){let{comparators:n}=e;return R("match",(t,{type:o,data:r})=>{if(o!=="match")throw new b("unsupported");let i=st(e),p=re(...n.map(s=>s(t)));return K(t,({matches:s})=>void s.sort(i)),(s,m)=>{let f=Math.min(s.matches.length,m.matches.length);for(let l=0,u=0;l<f;l++)if(u=i(s.matches[l],m.matches[l]),u!==0||(u=p(s.matches[l],m.matches[l]),u!==0))return u;return m.matches.length-s.matches.length}})}function st(e){let{fields:n,direction:t}=e,o=t==="ascending"?1:-1,r=new Map;for(let i=0;i<n.length;i++){let{name:p,meta:s}=n[i];r.set(p,s.weight??1)}return(i,p)=>o*(r.get(i.field)-r.get(p.field))}function Je(e,n={}){let t=U(e.query),o=W(fe),r=W(Le);return(i,p)=>{let s=o(i,t,u=>u),m=o(p,t,u=>u);if(s.length!==m.length)return m.length-s.length;let f=r(s),l=r(m);return f!==l?f-l:s[0]!==m[0]?s[0]-m[0]:0}}function Ze(e){let n=new Map;return F({name:"order",data:Xe(),async onTextOptions(t,o){for(let r=0;r<e.handlers.length;r++){let i=await e.handlers[r](t,o);n.set(i.name,i)}},onTextQuery(t){this.data.directives=t.order??e.defaults?.order??[]},onTextResult(t){let{directives:o}=this.data,r=[];for(let i=0;i<o.length;i++){let p=o[i],s=n.get(p.type);if(typeof s>"u")throw new b("unknown");r.push(s(t,p))}t.items.sort(re(...r))}})}function $e(e){let n=e.handler();return F({name:"pagination",onTextQuery(t){return n.onQuery(t,e)},onTextResult(t){return n.onResult(t,e)}})}function Ce(e){let{id:n,size:t=10,from:o=0}=e;if(o-t>=0)return{id:n,size:t,from:o-t}}function et(e,n){let{id:t,size:o=10,from:r=0}=e;if(r+o<n)return{id:t,size:o,from:r+o}}function tt(){return{query:null,result:null}}function ot(e={}){let{cache:n=tt(),expires:t=1/0}=e;return{data:n,onQuery(o,{size:r=10}){let i=n.query?.page?.id??0,p=Date.now()-i<t;n.query=Object.assign({},o),n.result&&o.page?.id===i&&p?o.abort=!0:(n.query.page={id:Date.now(),size:r,from:0},n.result=null)},onResult(o){let r=n.query.page;n.result??=o,o=Object.assign({},n.result);let i=n.result.items.length;return o.pagination={total:i,prev:Ce(r),next:et(r,i)},o.items=n.result.items.slice(r.from,r.from+r.size),o}}}var rt=null;self.onmessage=async e=>{let n=e.data;switch(n.type){case 0:rt=await Qe(n.data.items,{separator:Pe(n.data.config.separator),transform:W(Ve),parser:o=>He(o,"and",r=>({field:"*",value:Be(r.value),range:{start:r.start,end:r.end,value:r.index}})),compiler:_e,fields:[z("title",o=>o.title,{weight:3}),z("text",o=>o.text),z("path",o=>o.path,{weight:2})],plugins:[Ke(),We({compiler:ee,fields:[z("tags",o=>o.tags)],plugins:[ke({handlers:[Me()]})]}),Ze({handlers:[o=>qe({fields:o.fields,comparators:[Je]})],defaults:{order:[{type:"match",data:{field:"*"}}]}}),()=>F({onTextResult(o){o.total=o.items.length}}),$e({handler:ot,size:10}),je({handler:o=>Ye(o)}),()=>F({onTextResult(o){let{query:r}=o,i=r.values.map(({range:p})=>(p?.end??0)-(p?.start??0));q(o,p=>{p.value.highlight?.ranges.forEach(s=>{s.value=i[s.value]})})}})]}),self.postMessage({type:1});break;case 2:let t=rt({type:"text",data:n.data});self.postMessage({type:3,data:t.data});break}};
//# sourceMappingURL=bundle.XWCNCGF6.js.map
