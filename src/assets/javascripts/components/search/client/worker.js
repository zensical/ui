function z(e,r,t={}){return{name:e,from:r,meta:t}}function H(e,r){let t=[{value:e,depth:0}];for(let o=0,n=-1,s=0;o>=0;){let{value:i,depth:p}=t[o];if(n<=p&&i.type==="operator"&&i.data.operands.length>0)for(let u=i.data.operands.length;u>0;)t[++o]={value:i.data.operands[--u],depth:p+1};else{let u=r(i,s++,p);if(typeof u<"u")return u;--o}n=p}}var b=class extends Error{constructor(t,o){super(o);this.code=t}};function K(e,r){let t=at(e);for(let o=0;o<t.length;o++){let n=r(t[o]);if(typeof n<"u")return n}}function at(e){return e.items}function q(e,r){return K(e,t=>{let{matches:o}=t;for(let n=0;n<o.length;n++){let s=r(o[n],t);if(typeof s<"u")return s}})}function W(e,r=new Map){return(t,...o)=>{let n=r.get(t);return typeof n>"u"&&r.set(t,n=e(t,...o)),n}}function R(e,r){return Object.defineProperty(r,"name",{value:e}),r}async function Q(e){let r=[];if(typeof e.plugins<"u")for(let t=0;t<e.plugins.length;t++){let o=e.plugins[t];r.push(typeof o=="function"?await o(e):o)}return r}async function G(e,r){for(let t=0;t<e.length;t++){let o=r(e[t]);o instanceof Promise&&await o}}function v(e,r,t){for(let o=0;o<e.length;o++){let n=r(t,e[o]);typeof n<"u"&&(t=n)}return t}async function J(e,r,t){for(let o=0;o<e.length;o++){let n=r(t,e[o]);typeof n<"u"&&(t=n instanceof Promise?await n??t:n)}return t}function xe(e){return typeof e!="object"?{node:e,children:[]}:e}function de(e){return typeof e=="object"&&e!==null&&"select"in e&&"values"in e}function Z(e){return Math.max(1,Math.ceil(Math.log2(e)))}function ge(e){if(e.d+e.f+e.x>32)throw new RangeError("Bit format exceeds 32 bits");return e}function Y(e,r,t){let o=Z(e),n=Z(r),s=typeof t<"u"?Z(t):32-o-n;return ge({d:o,f:n,x:s})}var I=[0];for(let e=0;e<32;e++)I.push(I[e]|1<<e);function Te(e){return new Uint8Array(e)}function pe(e){return new Uint32Array(e)}function E(){return[0].slice(0,0)}function ye(){return[1/0].slice(0,0)}var L=class{constructor(r=[]){this.data=r}magnitude=0;add(r,t,o){this.data.push({start:r,end:t,value:o}),this.magnitude=0}get(r){for(let t=0;t<this.data.length;t++){let{start:o,end:n,value:s}=this.data[t];if(r>=o&&r<n)return s}return 0}forEach(r){for(let t=0;t<this.data.length;t++){let{start:o,end:n,value:s}=this.data[t];for(let i=o;i<n;i++)r(i,s)}}get length(){return this.magnitude||=j(this)}};var S=class{constructor(r,t=E()){this.data=r;this.cols=t}magnitude=0;add(r,t){this.cols.push(r),this.data.push(t),this.magnitude=0}get(r){for(let t=0;t<this.cols.length;t++)if(this.cols[t]===r)return this.data[t];return 0}forEach(r){for(let t=0;t<this.cols.length;t++)r(this.cols[t],this.data[t])}get length(){return this.magnitude||=j(this)}};function j(e){let r=0;return e.forEach((t,o)=>{r+=o*o}),Math.sqrt(r)}function he(e,r){e instanceof L?e.data.forEach((t,o)=>{r(t,o)}):e.forEach((t,o)=>{r({start:t,end:t+1,value:1},o)})}var O=class{constructor(r,t=pe(Math.ceil(r/32))){this.size=r;this.data=t}get(r){return this.data[r>>>5]>>>r&1}set(r){this.data[r>>>5]|=1<<(r&31)}forEach(r){let t=this.size&31;for(let o=0;o<this.data.length;o++){if(this.data[o]===0)continue;let n=this.data[o];t&&o===this.data.length-1&&(n=n&I[t]);for(let s=0,i=32-Math.clz32(n);s<i;s++)n&1<<s&&r((o<<5)+s)}}};function $(e,r){for(let t=0;t<e.data.length;t++)e.data[t]&=~r.data[t]}function F(e,r){r*=I[32]>>>0;for(let t=0;t<e.data.length;t++)e.data.fill(r)}function N(e,r){for(let t=0;t<e.data.length;t++)e.data[t]&=r.data[t]}function C(e){for(let r=0;r<e.data.length;r++)e.data[r]^=I[31]}function k(e,r){for(let t=0;t<e.data.length;t++)e.data[t]|=r.data[t]}function Ee(e,r){let t=[{value:e,depth:0}];for(let o=1,n=0;o>0;n++){let{value:s,depth:i}=t[--o],p=r(s,n,i);if(typeof p<"u")return p;for(let u=s.children.length;u>0;)t[o++]={value:s.children[--u],depth:i+1}}}async function ue(e,r){let{fields:t,plugins:o=[]}=r,n=Y(e.length,t.length),s=[];for(let u=0;u<t.length;u++)s.push({terms:[],index:new Map});for(let u=0;u<e.length;u++)for(let f=0;f<t.length;f++){let c=t[f].from(e[u]);if(typeof c>"u")continue;let m=u<<n.f|f;c=v(o,(x,d)=>d.onFilterInput?.(x,m,n),c);let l=s[f],a=E();c=Array.isArray(c)?c:[c];for(let x=0;x<c.length;x++){let d=xe(c[x]);Ee(d,(g,y,T)=>{let h=l.index.get(g.node);typeof h>"u"&&l.index.set(g.node,h=E());let V=l.terms.length;for(let A=0;A<h.length;A++){let _=l.terms[h[A]];if(_.position.depth===T){if(T&&a[T-1]!==_.position.prior)continue;V=h[A];break}}V===l.terms.length&&l.terms.push({value:g.node,occurrences:E(),position:{prior:T?a[T-1]:V,depth:T}});let{occurrences:w}=l.terms[V];w.push(m<<n.x|y),a[T]=V;for(let A=0;A<h.length;A++)if(h[A]===V)return;h.push(V)})}}let i={documents:e.length,fields:t.length},p={shards:s,space:n,count:i};return await G(o,u=>u.onFilterStore?.(p,r,e)),p}function Ie(e,r,t,o={}){let n=[];if(r<0||r>=e.count.fields)return n;let s=e.shards[r],i=new Map,{count:p=1/0,depth:u=1/0}=o;for(let f=0;f<s.terms.length;f++){let c=s.terms[f],m=t(c,f);if(typeof m<"u"){let{prior:l,depth:a}=c.position;if(a>u)continue;let x=i.get(c);typeof x>"u"&&i.set(c,x={node:m,children:[]});let d=n;a>0&&(d=i.get(s.terms[l]).children),d.length<p&&d.push(x)}}return n}function Ve(e,r,t){let{documents:o,terms:n}=M(e);if(t<0||t>=e.count.fields)return{documents:o,terms:n};let s=e.shards[t];return r.forEach(i=>{let{occurrences:p}=s.terms[i];for(let u=0;u<p.length;u++){let m=p[u]>>>e.space.x>>>e.space.f;o.set(m)}n[t].set(i)}),{documents:o,terms:n}}function be(e){let{documents:r,terms:t}=M(e);F(r,1);for(let o=0;o<t.length;o++)F(t[o],1);return{documents:r,terms:t}}function M(e){return{documents:new O(e.count.documents),terms:e.shards.map(({terms:r})=>new O(r.length))}}function me(e,r,t){let{compiler:o,fields:n,plugins:s=[]}=t,{input:i,scope:p,abort:u=!1}=v(s,(m,l)=>l.onFilterQuery?.(m,e,t),r),f={items:[],query:{select:M(e),values:[]}},c=new Map;if(u===!1){let m=o(t),{select:l,values:a}=m(i,e);typeof p<"u"&&N(l.documents,p);let x=new Map;f.query={select:l,values:a},l.terms.forEach((d,g)=>{d.forEach(y=>{let T=e.shards[g],{occurrences:h}=T.terms[y];for(let V=0;V<h.length;V++){let w=h[V],A=w>>>e.space.x,_=A>>>e.space.f;if(!l.documents.get(_))continue;let D=x.get(A);typeof D>"u"&&x.set(A,D=new S(E()));let lt=w&I[e.space.x];D.add(lt,y)}})}),l.documents.forEach(d=>{let g={id:d,matches:[]};f.items.push(g),c.set(d,g)}),x.forEach((d,g)=>{let y=g>>>e.space.f,T=g&I[e.space.f];c.get(y).matches.push({id:g,field:n[T].name,value:{filter:d},score:0})})}return v(s,(m,l)=>l.onFilterResult?.(m,e,t),f)}function ee(e){let{fields:r}=e;return(t,o)=>{if(de(t))return t;let n=[be(o)],s=[],i=0;return H(t,({type:p,data:u})=>{switch(p){case"value":let f=r.findIndex(({name:l})=>l===u.field);if(f===-1){n[i++]=M(o);break}let c=u.value;if(typeof c!="object"){let l=new S(E()),a=o.shards[f],x=a.index.get(c);if(typeof x<"u")for(let d=0;d<x.length;d++){let g=x[d];if(typeof u.depth<"u"){let{position:y}=a.terms[g];if(y.depth!==u.depth)continue}l.add(g,1)}c=l}n[i++]=Ve(o,c,f),s.push({...u,value:c});break;case"operator":let m=i-u.operands.length;switch(u.operator){case"or":for(;i>m+1&&i--;){k(n[m].documents,n[i].documents);for(let l=0;l<r.length;l++)k(n[m].terms[l],n[i].terms[l])}break;case"and":for(;i>m+1&&i--;){N(n[m].documents,n[i].documents);for(let l=0;l<r.length;l++)k(n[m].terms[l],n[i].terms[l])}break;case"not":C(n[m].documents);for(let l=0;l<r.length;l++)F(n[m].terms[l],0);for(;i>m+1&&i--;)$(n[m].documents,n[i].documents)}}}),{select:n[0],values:s}}}function fe(e){return{name:e.name,data:e.data,onFilterOptions:e.onFilterOptions,onFilterInput:e.onFilterInput,onFilterStore:e.onFilterStore,onFilterQuery:e.onFilterQuery,onFilterResult:e.onFilterResult}}function te(e){return typeof e=="object"&&e!==null&&"type"in e&&"data"in e}function Re(e){return typeof e=="object"&&e!==null&&"select"in e&&"values"in e}function Se(e){return e.normalize("NFKD").toLowerCase()}function Oe(e,r){let t=Math.min(e.length,r.length);for(let o=0;o<t;o++)if(e.charCodeAt(o)!==r.charCodeAt(o))return o;return t}function ce(e,r,t=0,o=e.length){for(let n=0;t<o;t+=1+ +(n>65535)){let s=r(n=e.codePointAt(t),t);if(typeof s<"u")return s}}function oe(e,r,t=0,o=e.length){let n=E();return ce(e,s=>{n.push(s);let i=r(String.fromCodePoint(...n),n.length);if(typeof i<"u")return i},t,o)}function Pe(e,r,t=0,o=e.length){let n=t;for(let s=0;n<o;n++)switch(s=e.charCodeAt(n),s){case 60:n>t&&r(t,t=n);continue;case 62:t=n+1}n>t&&r(t,n)}function le(e,r,t,o=0){return Pe(e,(n,s)=>r(e,(i,p)=>{o=t({value:e.slice(i,p),index:o,start:i,end:p})},n,s)),o}function ve(e,r,t,o=0){for(let n=0,s=0;n<e.length;s+=e[n++].length)o=le(e[n],r,i=>(i.start+=s,i.end+=s,t(i)),o);return o}function Fe(e){let r=new RegExp(e,"gu");return(t,o,n=0,s=t.length)=>{r.lastIndex=n;let i,p=0;do{i=r.exec(t);let u=i?.index??s;n<u&&o(n,Math.min(u,s)),i&&(p=i[0].length,n=i.index+p,p===0&&(r.lastIndex=i.index+1))}while(i&&n<s)}}async function we(e,r){let{separator:t,transform:o,fields:n,plugins:s=[]}=r,i=Y(e.length,n.length),p=new Map;for(let m=0;m<e.length;m++)for(let l=0;l<n.length;l++){let a=n[l].from(e[m]);if(typeof a>"u")continue;let x=m<<i.f|l;a=v(s,(d,g)=>g.onTextInput?.(d,x,i),a),a=Array.isArray(a)?a:[a],ve(a,t,d=>{let g=v(s,(y,T)=>T.onTextTokens?.(y),[d]);for(let y=0;y<g.length;y++){d=g[y];let T=o(d.value),h=p.get(T);typeof h>"u"?p.set(T,[x<<i.x|d.index]):h.push(x<<i.x|d.index)}return g.length?d.index+1:d.index})}let u={documents:e.length,fields:n.length},f={terms:[],index:new Map,space:i,count:u},c=[...p.keys()].sort();for(let m=0;m<c.length;m++)f.index.set(c[m],m),f.terms.push({value:c[m],occurrences:p.get(c[m])});return await G(s,m=>m.onTextStore?.(f,r,e)),f}function Le(e,r,t){let{documents:o,terms:n}=B(e);return t<0||t>=e.count.fields?{documents:o,terms:n}:(r.forEach(s=>{let{occurrences:i}=e.terms[s];for(let p=0;p<i.length;p++){let f=i[p]>>>e.space.x;if((f&I[e.space.f])!==t)continue;let m=f>>>e.space.f;o.set(m)}n.set(s)}),{documents:o,terms:n})}function _e(e,r){let{documents:t,terms:o}=B(e),n=e.space.f+e.space.x;return r.forEach(s=>{let{occurrences:i}=e.terms[s];for(let p=0;p<i.length;p++)t.set(i[p]>>>n);o.set(s)}),{documents:t,terms:o}}function B(e){return{documents:new O(e.count.documents),terms:new O(e.terms.length)}}function Ne(e,r,t){let{compiler:o,fields:n,plugins:s=[]}=t,{input:i,scope:p,abort:u=!1}=v(s,(m,l)=>l.onTextQuery?.(m,e,t),r),f={items:[],query:{select:B(e),values:[]}},c=new Map;if(u===!1){let m=o(t),{select:l,values:a}=m(i,e);typeof p<"u"&&N(l.documents,p);let x=new O(n.length),d=new Map;f.query={select:l,values:a},l.terms.forEach(g=>{F(x,0);for(let T=0;T<a.length;T++){let{field:h,value:V}=a[T];if(h==="*"){F(x,1);break}else if(V.get(g)){for(let w=0;w<n.length;w++)if(n[w].name===h){x.set(w);break}}}let{occurrences:y}=e.terms[g];for(let T=0;T<y.length;T++){let h=y[T],V=h>>>e.space.x,w=V>>>e.space.f;if(!l.documents.get(w))continue;let A=V&I[e.space.f];if(!x.get(A))continue;let _=d.get(V);typeof _>"u"&&d.set(V,_=new S(E()));let D=h&I[e.space.x];_.add(D,g)}}),l.documents.forEach(g=>{let y={id:g,matches:[]};f.items.push(y),c.set(g,y)}),d.forEach((g,y)=>{let T=y>>>e.space.f,h=y&I[e.space.f];c.get(T).matches.push({id:y,field:n[h].name,value:{text:g},score:0})})}return v(s,(m,l)=>l.onTextResult?.(m,e,t),f)}function ke(e,r=10){return e.length>1?1+e[e.length-1]-e[0]:r}function ae(e,r,t,o=10){let n=[];e.value.text.forEach((p,u)=>{for(let f=0;f<r.data.length;f++){let{start:c,end:m}=r.data[f];c<=u&&u<m&&n.push({index:p,value:f})}}),n.sort((p,u)=>p.index-u.index);let s=n.slice(0,1),i=0;for(let p=0;p<n.length-1;p++){let u=n[p],f=n[p+1],c;if(f.index-u.index>o||f.value===u.value)c=s.map(({index:m})=>m),s=[n[p+1]];else{for(let m=0;m<s.length;m++){let l=s[m];if(l.value===f.value){if(u.index-l.index>f.index-u.index){let a=s.splice(m+1);c=s.map(({index:x})=>x),s=[...a,n[p+1]]}else c=s.map(({index:a})=>a),s=[n[p+1]];break}}typeof c>"u"&&s.push(n[p+1])}if(typeof c<"u"){let m=t(c,i++);if(typeof m<"u")return m}}if(s.length)return t(s.map(({index:p})=>p),i)}function He(e){let{transform:r,parser:t,fields:o}=e,n=t(e);return(s,i)=>{if(Re(s))return s;typeof s=="string"&&(s=n(s));let p=[B(i)],u=[],f=0;return H(s,({type:c,data:m})=>{switch(c){case"value":let l=m.value;if(typeof l=="string"){let x=new S(E()),d=i.index.get(r(l));typeof d<"u"&&x.add(d,1),l=x}if(m.field==="*")p[f++]=_e(i,l);else{let x=o.findIndex(({name:d})=>d===m.field);p[f++]=Le(i,l,x)}u.push({...m,value:l});break;case"operator":let a=f-m.operands.length;switch(m.operator){case"or":for(;f>a+1&&f--;)k(p[a].documents,p[f].documents),k(p[a].terms,p[f].terms);break;case"and":for(;f>a+1&&f--;)N(p[a].documents,p[f].documents),k(p[a].terms,p[f].terms);break;case"not":for(C(p[a].documents),F(p[a].terms,0);f>a+1&&f--;)$(p[a].documents,p[f].documents)}}}),{select:p[0],values:u}}}function ne(e,r){return H(e,(t,o,n)=>{if(t.type!=="value")return;let s=r(t.data,o,n);if(typeof s<"u")return s})}function re(e){if(e.length===0)return[];let r=[],t=[];for(let s=0;s<e.length;s++){let{start:i,end:p}=e[s];t.push({index:i,value:s}),t.push({index:p,value:s})}t.sort((s,i)=>s.index-i.index);let o=new Set([t[0].value]),n=t[0].index;for(let s=1;s<t.length;s++){let{index:i,value:p}=t[s];if(o.size&&n<i){let u=p;o.forEach(f=>{e[f].start>n||e[f].end<i||e[u].start!==e[f].start&&e[u].end!==e[f].end&&(u=f)}),r.push({start:n,end:i,value:e[u].value})}n=i,o.has(p)?o.delete(p):o.add(p)}return r}function U(e){let r=[];for(let t=0;t<e.values.length;t++){let{value:o}=e.values[t];he(o,({start:n,end:s})=>{r.push({start:n,end:s,value:t})})}return new L(re(r))}function Qe(e,r="or",t){let{separator:o}=e;return t??=n=>({field:"*",value:n.value}),n=>{let s=[];return le(n,o,i=>{let p=t(i);typeof p<"u"&&s.push({type:"value",data:p})}),{type:"operator",data:{operator:r,operands:s}}}}async function Me(e,r){let t=await Q(r),o=await J(t,(s,i)=>i.onTextOptions?.(s,e),{...r,plugins:t}),n=await we(e,o);return R("text",s=>{if(s.type!=="text")throw new b("unsupported");return{type:s.type,data:Ne(n,s.data,o)}})}function P(e){return{name:e.name,data:e.data,onTextOptions:e.onTextOptions,onTextInput:e.onTextInput,onTextTokens:e.onTextTokens,onTextStore:e.onTextStore,onTextQuery:e.onTextQuery,onTextResult:e.onTextResult}}function Be(e){let{handlers:r}=e,t,o=new Map;return fe({name:"aggregation",onFilterStore(n,s){for(let i=0;i<r.length;i++){let p=r[i](n,s);o.set(p.name,p)}},onFilterQuery(n){t=n.aggregation?.input??[]},onFilterResult(n){let{select:s}=n.query;n.aggregations=[];for(let i of t){let p=o.get(i.type);if(typeof p>"u")continue;let u=!0;s.documents.forEach(f=>{u=!1}),u&&F(s.documents,1),n.aggregations.push(p(i,s))}}})}function Ue(e={}){let{empty:r=!1,limit:t}=e;return(o,{fields:n})=>{let s=o.space.f+o.space.x;return R("term",({type:i,data:p},{documents:u})=>{if(i!=="term")throw new b("unsupported");let f=n.findIndex(({name:m})=>m===p.field),c=Ie(o,f,m=>{let l=0,{occurrences:a}=m;for(let x=0;x<a.length;x++)u.get(a[x]>>>s)&&l++;if(!(r===!1&&l===0))return{value:m.value,count:l}},{...t,...p.limit});return{type:i,data:{field:p.field,value:c}}})}}function De(e,r="prefix"){return{type:r,data:e}}function ze(e){return typeof e=="object"&&"type"in e&&typeof e.type=="string"&&"data"in e&&typeof e.data=="string"}function Ke(e,r={}){let{prefix:t=2,filter:o=[]}=r,n=e.terms,s=new Map,i=Te(n.length),p=E();for(let u=0;u<n.length;u++){let f=n[u];oe(f,(m,l)=>(s.set(m,s.get(m)??u),l===t||void 0));let c=u?n[u-1]:"";i[u]=Oe(c,f)}for(let u=0;u<o.length;u++){let f=o[u],c=e.index?.get(f);typeof c<"u"&&p.push(c)}return p.sort((u,f)=>u-f),{terms:n,index:s,cover:i,exact:p}}function We(e,r){let t="",o=-1,n=-1;if(oe(r,p=>{let u=e.index.get(p);if(typeof u>"u")return!0;t=p,o=u}),o!==-1)for(let p=t.length;p<r.length;){let u=e.terms[o];if(u.length===p)if(++o===e.terms.length){o=-1;break}else continue;if(u.charCodeAt(p)===r.charCodeAt(p))p++;else if(e.terms.length===++o||e.cover[o]<p){o=-1;break}}if(o===-1)return;for(n=o+1;n<e.terms.length&&!(e.cover[n]<r.length);n++);let s=[],i=e.exact.filter(p=>p>o&&p<n);for(let p=0;p<i.length;p++)o<i[p]&&s.push({start:o,end:i[p]-1,value:1}),o=i[p]+1;return o<=n&&s.push({start:o,end:n,value:1}),new L(s)}function Ge(e={}){return P({name:"expansion",onTextStore(r,t){let{transform:o}=t;this.data??=Ke({terms:r.terms.map(({value:n})=>n),index:r.index},{prefix:e.prefix,filter:e.filter?.map(o)})},onTextQuery(r,t,o){let{transform:n,parser:s}=o;if(typeof r.input=="string")r.input=s(o)(r.input);else if(!te(r.input))return;ne(r.input,i=>{let p=i.value;if(ze(p))p=n(p.data);else return;i.value=We(this.data,p)??p})}})}function Ye(e){let r={...e,plugins:[]},t,o,n;return P({name:"filter",async onTextOptions(s,i){r.plugins=await Q(e),n=await ue(i,r)},onTextQuery(s){typeof s.filter<"u"&&(t=s.filter,o??=ee(r),t.input=o(t.input,n),s.scope=t.input.select.documents)},onTextResult(s){if(typeof t<"u"){let i=!0;s.query.select.documents.forEach(u=>{i=!1}),i||(t.scope=s.query.select.documents);let p=me(n,t,r);s.aggregations=p.aggregations,t=void 0}}})}function je(e,r){let t=[],o=e/r>>>0,n=e%r,s=0;if(o)for(let i=0;i<r-n;i++,s+=o)t.push(s);if(n)for(let i=0;i<n;i++,s+=o+1)t.push(s);return t.push(s),t}function Xe(e,r){let t=je(e.length,r),o=[];for(let n=0;n<t.length-1;n++)o.push(e.slice(t[n],t[n+1]));return o}function qe(e,r,t){let o=je(r,t+1),n=e.length-r,s=[];for(let i=0;i<o.length-1;i++){let p=o[i+1]-o[i],u=1+o[i],f=Math.max(u-i,u+n-(t-i),1),c=Math.min(u+i,u+n+(t-i),1+e.length-p);s[i]=[];for(let m=f-1;m<c;m++)s[i].push(e.slice(m,m+p))}return s}function Je(e,r={}){let{threshold:t=2}=r,o=e.terms.map((i,p)=>p);o.sort((i,p)=>e.terms[i].length-e.terms[p].length||e.terms[i].localeCompare(e.terms[p]));let n=0;for(let i=0;i<e.terms.length;i++)e.terms[i].length>n&&(n=e.terms[i].length);let s=[];for(let i=0;i<n+1;i++){let p=[];s.push(p);for(let u=0;u<t+1;u++)p.push(new Map)}for(let i=0;i<o.length;i++){let p=e.terms[o[i]],u=s[p.length],f=Xe(p,t+1);for(let c=0;c<f.length;c++){let m=f[c],l=u[c].get(m);typeof l>"u"?u[c].set(m,[o[i]]):l.push(o[i])}}return{index:s,terms:e.terms,idxmp:o}}var xt=[["id","di","rr"],["dr","rd"],["dd"]];function ie(e,r,t=2){if(e.length<r.length)return ie(r,e,t);let o=e.length,n=r.length,s=o-n;if(s>t)return;let i,p,u,f=t+1;for(let c of xt[s]){for(u=i=p=0;i<o&&p<n;)if(e[i]!==r[p]){if(++u>t)break;switch(c[u-1]){case"d":i++;break;case"i":p++;break;case"r":i++,p++;break}}else i++,p++;u+=o-i+(n-p),u<f&&(f=u)}return f<t+1?f:void 0}function Ze(e,r,t=ie){let n=new S(ye());for(let s=-2;s<3;s++){let i=r.length+s;if(typeof e.index[i]>"u")continue;let p=qe(r,i,2);for(let u=0;u<p.length;u++){let f=e.index[i][u],c=p[u];for(let m=0;m<c.length;m++){let l=f.get(c[m]);if(!(typeof l>"u"))for(let a of l){let x=e.terms[a].length,d=t(e.terms[a],r);typeof d<"u"&&n.add(a,(x-d)/x)}}}}if(n.data.length)return n}function $e(e={}){return P({name:"fuzzy",onTextStore(r){this.data??=Je({terms:r.terms.map(({value:t})=>t)},e)},onTextQuery(r,t,o){let{transform:n,parser:s}=o;if(typeof r.input=="string")r.input=s(o)(r.input);else if(!te(r.input))return;ne(r.input,i=>{let p=i.value;if(typeof p=="string")p=n(p);else return;t.index.get(p)||(i.value=Ze(this.data,p)??p)})}})}function Ce(){return{tables:new Map}}function et(e,r={}){let{count:t}=r;return R("term",o=>{let n=U(o);return(s,i)=>{let p=[];return s.value.text.forEach((u,f)=>{let c=i[u]>>>10,m=i[u]&I[10];for(let x=0;x<n.data.length;x++){let{start:d,end:g}=n.data[x];if(d<=f&&f<g){f=n.data[x].value;break}}let l=c,a=c+m;p.push({start:l,end:a,value:f})}),p.sort((u,f)=>u.start-f.start),{ranges:re(p).slice(0,t)}}})}function tt(e){let r,t;return P({name:"highlight",data:Ce(),onTextInput(o,n){let{tables:s}=this.data;s.set(n,t=E())},onTextTokens(o){for(let n=0;n<o.length;n++){let{index:s,start:i,end:p}=o[n];t[s]=i<<10|p-i}},onTextStore(o){r=e.handler(o)},onTextResult(o){let{tables:n}=this.data,s=r(o.query);q(o,i=>{let p=n.get(i.id);if(i.value.highlight)return;let u=s(i,p);i.value={...i.value,highlight:u}})}})}function ot(){return{directives:[]}}function se(...e){return(r,t)=>{for(let o=0;o<e.length;o++){let n=e[o](r,t);if(n!==0)return n}return 0}}function nt(e){let{comparators:r}=e;return R("match",(t,{type:o,data:n})=>{if(o!=="match")throw new b("unsupported");let s=dt(e),i=se(...r.map(p=>p(t)));return K(t,({matches:p})=>void p.sort(s)),(p,u)=>{let f=Math.min(p.matches.length,u.matches.length);for(let c=0,m=0;c<f;c++)if(m=s(p.matches[c],u.matches[c]),m!==0||(m=i(p.matches[c],u.matches[c]),m!==0))return m;return u.matches.length-p.matches.length}})}function dt(e){let{fields:r,direction:t}=e,o=t==="ascending"?1:-1,n=new Map;for(let s=0;s<r.length;s++){let{name:i,meta:p}=r[s];n.set(i,p.weight??1)}return(s,i)=>o*(n.get(s.field)-n.get(i.field))}function rt(e,r={}){let t=U(e.query),o=W(ae),n=W(ke);return(s,i)=>{let p=o(s,t,m=>m),u=o(i,t,m=>m);if(p.length!==u.length)return u.length-p.length;let f=n(p),c=n(u);return f!==c?f-c:p[0]!==u[0]?p[0]-u[0]:0}}function it(e){let r=new Map;return P({name:"order",data:ot(),async onTextOptions(t,o){for(let n=0;n<e.handlers.length;n++){let s=await e.handlers[n](t,o);r.set(s.name,s)}},onTextQuery(t){this.data.directives=t.order??e.defaults?.order??[]},onTextResult(t){let{directives:o}=this.data,n=[];for(let s=0;s<o.length;s++){let i=o[s],p=r.get(i.type);if(typeof p>"u")throw new b("unknown");n.push(p(t,i))}t.items.sort(se(...n))}})}function st(e){let r=e.handler();return P({name:"pagination",onTextQuery(t){return r.onQuery(t,e)},onTextResult(t){return r.onResult(t,e)}})}function pt(e){let{id:r,size:t=10,from:o=0}=e;if(o-t>=0)return{id:r,size:t,from:o-t}}function ut(e,r){let{id:t,size:o=10,from:n=0}=e;if(n+o<r)return{id:t,size:o,from:n+o}}function mt(){return{query:null,result:null}}function ft(e={}){let{cache:r=mt(),expires:t=1/0}=e;return{data:r,onQuery(o,{size:n=10}){let s=r.query?.page?.id??0,i=Date.now()-s<t;r.query=Object.assign({},o),r.result&&o.page?.id===s&&i?o.abort=!0:(r.query.page={id:Date.now(),size:n,from:0},r.result=null)},onResult(o){let n=r.query.page;r.result??=o,o=Object.assign({},r.result);let s=r.result.items.length;return o.pagination={total:s,prev:pt(n),next:ut(n,s)},o.items=r.result.items.slice(n.from,n.from+n.size),o}}}var ct=null;self.onmessage=async e=>{let r=e.data;switch(r.type){case 0:ct=await Me(r.data.items,{separator:Fe(r.data.config.separator),transform:W(Se),parser:o=>Qe(o,"and",n=>({field:"*",value:De(n.value),range:{start:n.start,end:n.end,value:n.index}})),compiler:He,fields:[z("title",o=>o.title,{weight:3}),z("text",o=>o.text),z("path",o=>o.path,{weight:2})],plugins:[Ge(),$e(),Ye({compiler:ee,fields:[z("tags",o=>o.tags)],plugins:[Be({handlers:[Ue()]})]}),it({handlers:[o=>nt({fields:o.fields,comparators:[rt]})],defaults:{order:[{type:"match",data:{field:"*"}}]}}),()=>P({onTextResult(o){o.total=o.items.length}}),st({handler:ft,size:10}),tt({handler:o=>et(o)}),()=>P({onTextResult(o){let{query:n}=o,s=n.values.map(({range:i,value:p})=>{let u=!1;return p.forEach((f,c)=>{!u&&c<1&&(u=!0)}),u?-1:(i?.end??0)-(i?.start??0)});q(o,i=>{i.value.highlight?.ranges.forEach(p=>{p.value=s[p.value]})})}})]}),self.postMessage({type:1});break;case 2:let t=ct({type:"text",data:r.data});self.postMessage({type:3,data:t.data});break}};
//# sourceMappingURL=bundle.Q5Z2Y6JE.js.map
